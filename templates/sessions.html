<!DOCTYPE html>
<html>
<head>
  <title>Training Sessions</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <header style="display: flex; justify-content: space-between; align-items: center; background-color: #001f3f; color: white; padding: 10px 20px; border-radius: 8px;">
    <div style="display: flex; align-items: center;">
      <a href="{{ url_for('app_home') }}">
        <img src="{{ url_for('static', filename='EUBC_Logo.png') }}" alt="Logo" style="height: 50px; margin-right: 20px;">
      </a>
      <h1 style="margin: 0;">EUBC Data</h1>
    </div>
    <div style="text-align: right;">
      Logged in as <strong>{{ current_user.name }}</strong> |
      <a href="{{ url_for('logout') }}" style="color: white; text-decoration: underline;">Logout</a>
    </div>
  </header>

  <h2>Training Sessions</h2>

  <form method="GET" action="{{ url_for('sessions.sessions') }}" style="display: flex; flex-wrap: wrap; align-items: center; gap: 10px;">

    <label for="from_date">From:</label>
    <input type="date" name="from_date" value="{{ from_date or '' }}">
  
    <label for="to_date">To:</label>
    <input type="date" name="to_date" value="{{ to_date or '' }}">
  
    {% if current_user.coach %}
      <label for="athlete_id">Athlete:</label>
      <select name="athlete_id">
        <option value="">-- All Athletes --</option>
        {% for a in athletes %}
          <option value="{{ a.Athlete_ID }}" {% if selected_athlete == a.Athlete_ID|string %}selected{% endif %}>
            {{ a.Full_Name }}
          </option>
        {% endfor %}
      </select>
    {% endif %}
  
    <label for="activity">Activity:</label>
    <select name="activity">
      <option value="">-- All Activities --</option>
      {% for act in ['Erg', 'Bike', 'Run', 'Other'] %}
        <option value="{{ act }}" {% if selected_activity == act %}selected{% endif %}>{{ act }}</option>
      {% endfor %}
    </select>
  
    <label for="type">Type:</label>
    <select name="type">
      <option value="">-- All Types --</option>
      {% for typ in ['Test', 'Intervals', 'UT2', 'Cross-Training', 'Other'] %}
        <option value="{{ typ }}" {% if selected_type == typ %}selected{% endif %}>{{ typ }}</option>
      {% endfor %}
    </select>
  
    <button class="btn" type="submit">Filter</button>
    {% if current_user.coach %}
      <a class="btn" href="{{ url_for('sessions.add_session') }}">Add New Session</a>
    {% else %}
      <a class="btn" href="{{ url_for('sessions.add_session') }}">Log New Session</a>
    {% endif %}
  
    <button class="btn" type="submit" formaction="{{ url_for('sessions.download_sessions_csv') }}">Download CSV</button>
  </form>

  <table>
    <thead>
      <tr>
        <th>Date</th><th>Activity</th><th>Duration</th><th>Distance</th><th>Split</th><th>Type</th><th>Weight</th><th>Comment</th>
        {% if current_user.coach %}<th>Athlete</th><th>Actions</th>{% endif %}
      </tr>
    </thead>
    <tbody>
      {% for s in sessions %}
      <tr>
        <td>{{ s.Session_Date }}</td>
        <td>{{ s.Activity }}</td>
        <td>{{ s.Duration }}</td>
        <td>{{ s.Distance }}</td>
        <td>{{ s.Split }}</td>
        <td>{{ s.Type }}</td>
        <td>{{ s.Weight }}</td>
        <td>{{ s.Comment }}</td>
        {% if current_user.coach %}
        <td>{{ s.Full_Name }}</td>
        <td><a href="{{ url_for('sessions.edit_session', session_id=s.Session_ID) }}">Edit</a></td>
        {% endif %}
      </tr>
      {% endfor %}
    </tbody>
  </table>
</body>
</html>

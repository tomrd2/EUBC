<!DOCTYPE html>
<html>
<head>
  <title>Detailed Results</title>
  <link rel="stylesheet" href="{{ url_for('club_static', filename='style.css') }}">
  <style>
    body { min-width: 1000px; }
    .athlete-columns { display: flex; gap: 20px; margin-bottom: 30px; }
    .column { flex: 1; background: #f2f9ff; border: 1px solid #ccc; padding: 10px; border-radius: 6px; }
    .column h3 { text-align: center; margin-top: 0; background-color: #0074D9; color: white; padding: 8px; border-radius: 4px; }
    .athlete-name { margin: 5px 0; padding: 5px; background: white; border: 1px solid #ddd; border-radius: 4px; }

    /* Top bar */
    .topbar {
      display: flex; justify-content: space-between; align-items: center; margin-top: 20px;
    }
    .actions { display: flex; align-items: center; gap: 10px; }
    .btn-apply {
      background: #0074D9; color: #fff; border: none; padding: 8px 14px; border-radius: 4px; cursor: pointer;
    }
    .btn-apply:hover { opacity: 0.9; }
    th, td { padding: 6px 8px; border-bottom: 1px solid #eee; }
  </style>
</head>
<body>
  {% include "_header.html" %}

  <form method="POST" action="{{ url_for('results.update_unrated', outing_id=outing.Outing_ID) }}">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-top:20px;">
      <div style="display:flex;align-items:center;">
        <a href="{{ url_for('outings.outings') }}" class="btn" style="margin-right: 15px;">← Back</a>
        <h2 style="color:#001f3f;margin:0;">
          Results for {{ outing.Outing_Date }} – <em>{{ outing.Outing_Name }}</em>
        </h2>
      </div>
      <button type="submit" class="btn">Apply</button>
    </div>

    <div class="piece-results" style="display:flex;flex-direction:column;gap:20px;margin-top:20px;">
      {% for piece in pieces %}
        <div class="crew-column" data-piece-id="{{ piece.Piece_ID }}">
          <div class="crew-row" style="font-weight:bold;margin-bottom:5px;">
            <span>
              {{ piece.Description or '' }} &nbsp;–&nbsp;
              Distance: {{ piece.Distance or '' }}m &nbsp;–&nbsp;
              Rate Cap: {{ piece.Rate_Cap or '' }}
            </span>
          </div>

          <table style="margin-top:10px;width:100%;border-collapse:collapse;">
            <thead>
              <tr>
                <th style="text-align:left;">Crew Name</th>
                <th style="text-align:center;">Boat</th>
                <th style="text-align:center;">Time</th>
                <th style="text-align:center;">GMT %</th>
                <th style="text-align:center;">Expected %</th>
                <th style="text-align:center;">Net Gain</th>
                <th style="text-align:center;width:110px;">Unrated</th>
              </tr>
            </thead>
            <tbody>
              {% for result in results_by_piece[piece.Piece_ID] %}
                <tr>
                  <td style="text-align:left;">{{ result.Crew_Name }}</td>
                  <td style="text-align:center;">{{ result.Boat_Type }}</td>
                  <td style="text-align:center;">{{ result.Time or '—' }}</td>
                  <td style="text-align:center;">{{ result.GMT_Percent or '—' }}%</td>
                  <td style="text-align:center;">{{ result.Exp_Percent or '—' }}%</td>
                  <td style="text-align:center;">{{ result.Net_Gain or '—' }}%</td>

                  <td style="text-align:center;">
                    <!-- List every row shown -->
                    <input type="hidden" name="row_keys" value="{{ result.Piece_ID }}:{{ result.Crew_ID }}">
                    <!-- Checked rows post here -->
                    <input
                      type="checkbox"
                      name="unrated_keys"
                      value="{{ result.Piece_ID }}:{{ result.Crew_ID }}"
                      {% if result.Unrated %}checked{% endif %}
                      aria-label="Mark {{ result.Crew_Name }} (piece {{ result.Piece_ID }}) as Unrated">
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% endfor %}
    </div>
  </form>

</body>
</html>
